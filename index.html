<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>pistahx.io by mebyz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">pistahx.io</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/mebyz/pistahx" class="btn">View on GitHub</a>
      <a href="https://github.com/mebyz/pistahx/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/mebyz/pistahx/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="pistahxio--design-first-type-safe-haxe-web-api-framework" class="anchor" href="#pistahxio--design-first-type-safe-haxe-web-api-framework" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pistahx.io : Design-First Type-Safe Haxe Web API Framework</h1>

<ul>
<li>We'll be happy to meet you during WWX2016, the WorldWide Haxe conference in Paris (27-30 May 2016) ! </li>
<li>We are thrilled to give you the opportunity to attend to the first and live full presentation of pistahx (40 min talk)</li>
</ul>

<p><img src="http://www.silexlabs.org/wp-content/uploads/2016/02/wwx2016-bandeau-blog-18fev2016-687x159.png" alt=""></p>

<h1>
<a id="bootstrap-a-sample-pistahx-based-web-api" class="anchor" href="#bootstrap-a-sample-pistahx-based-web-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>bootstrap a sample pistahx based web api</h1>

<p>pistahx-app 
(sample Haxe api using pistahx, pistahx-db, pistahx-spec)</p>

<h3>
<a id="1-build-locally" class="anchor" href="#1-build-locally" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. BUILD LOCALLY</h3>

<pre><code>git clone git@github.com:mebyz/pistahx-app.git

cd pistahx-app

npm install -g gulp

npm install --only=dev

haxelib install ./node_modules/pistahx/gen/libs.hxml

gulp build

</code></pre>

<h3>
<a id="2-run-locally" class="anchor" href="#2-run-locally" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. RUN LOCALLY</h3>

<pre><code>gulp run

</code></pre>

<h1>
<a id="or" class="anchor" href="#or" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>OR</h1>

<h3>
<a id="1-build-from-docker" class="anchor" href="#1-build-from-docker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. BUILD FROM DOCKER</h3>

<pre><code>git clone git@github.com:mebyz/pistahx-app.git

cd pistahx-app

docker build -f Dockerfile.build -t pistahx/build .

docker run -d --name pistahx_build pistahx/build tail -f /dev/null

docker cp pistahx_build:/app/distrib/out ./distrib/out

</code></pre>

<p>=&gt; your built app now resides in distrib/out</p>

<h3>
<a id="2-run-from-docker" class="anchor" href="#2-run-from-docker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. RUN FROM DOCKER</h3>

<pre><code>docker build -f Dockerfile -t pistahx/run .

docker run pistahx/run

</code></pre>

<blockquote>
<ul>
<li><p>You'll need <strong>Haxe</strong> installed on your system</p></li>
<li><p>Design and implement  your api spec in the <strong>./app/api.yaml</strong> file</p></li>
<li><p>Code your business logic in the <strong>./app/Business/</strong> folder</p></li>
<li><p>Use the <strong>./app/conf/[env].yaml</strong> file to set your configuration (db user/pass, ...)</p></li>
<li><p>you'll need a running <strong>redis server</strong></p></li>
</ul>
</blockquote>

<h2></h2>

<h1>
<a id="pistahx-modules-" class="anchor" href="#pistahx-modules-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pistahx modules :</h1>

<blockquote>
<h4>
<a id="--httpsgithubcommebyzpistahxgit-pistahxs-core" class="anchor" href="#--httpsgithubcommebyzpistahxgit-pistahxs-core" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>- <a href="https://github.com/mebyz/pistahx.git">https://github.com/mebyz/pistahx.git</a> (pistahx's core)</h4>

<h4>
<a id="--httpsgithubcommebyzpistahx-dbgit-db-to-haxe-typedefs-generation-lib" class="anchor" href="#--httpsgithubcommebyzpistahx-dbgit-db-to-haxe-typedefs-generation-lib" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>- <a href="https://github.com/mebyz/pistahx-db.git">https://github.com/mebyz/pistahx-db.git</a> (DB to Haxe typedefs generation lib)</h4>

<h4>
<a id="--httpsgithubcommebyzpistahx-specgit-openapi-yaml-to-haxe-typedefs-generation-lib" class="anchor" href="#--httpsgithubcommebyzpistahx-specgit-openapi-yaml-to-haxe-typedefs-generation-lib" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>- <a href="https://github.com/mebyz/pistahx-spec.git">https://github.com/mebyz/pistahx-spec.git</a> (OpenAPI yaml to Haxe typedefs generation lib)</h4>

<h4>
<a id="--httpsgithubcommebyzpistahx-uigit-typescript-angular2-bootstrap4-ui-for-pistahx-apps" class="anchor" href="#--httpsgithubcommebyzpistahx-uigit-typescript-angular2-bootstrap4-ui-for-pistahx-apps" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>- <a href="https://github.com/mebyz/pistahx-ui.git">https://github.com/mebyz/pistahx-ui.git</a> (Typescript Angular2 Bootstrap4 UI for pistahx apps)</h4>

<h4>
<a id="--httpsgithubcommebyzpistahx-appgit-pistahx-demo-api-use-it-to-bootstrap-your-own-api-" class="anchor" href="#--httpsgithubcommebyzpistahx-appgit-pistahx-demo-api-use-it-to-bootstrap-your-own-api-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>- <a href="https://github.com/mebyz/pistahx-app.git">https://github.com/mebyz/pistahx-app.git</a> (pistahx demo api, use it to bootstrap your own api !)</h4>
</blockquote>

<h2></h2>

<h1>
<a id="pistahx-building-blocks-" class="anchor" href="#pistahx-building-blocks-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pistahx Building blocks :</h1>

<blockquote>
<p><img src="https://raw.githubusercontent.com/mebyz/pistahx/master/pistahx-stack-mini.png" alt=""></p>
</blockquote>

<h2></h2>

<h1>
<a id="pistahx-promises" class="anchor" href="#pistahx-promises" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pistahx promises:</h1>

<blockquote>
<ul>
<li>
<strong>PERFORMANCE :</strong> pistahx heavily relies on <strong>many cache layers</strong>, and let you define your own <strong>cache invalidation strategies</strong>

<ul>
<li>Custom output cache for each route based on your api specs</li>
<li>Secure Cookie based Session / Auth token Redis store</li>
<li>Pro-active cascading cache invalidation strategies</li>
<li>Db caching (via Sequelize) : use cache to store entities and queries</li>
<li>Define your own caching strategies for fine tuning</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>SECURITY :</strong> pistahx offers you <strong>multiple authentication strategies</strong> activate them in your configuration file ./app/conf/[env].yaml 

<ul>
<li>JSON Web Tokens (JWT) : if you want to build RestFULL APIs or if you have to deal with cookie-less clients</li>
<li>Standard but fast and secure sessions strategy if you're setting up a service targeting Web browsers supporting cookies</li>
<li>pistahx also implements Passport.js (which includes 300+ more auth strategies) !</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>MONITORING :</strong> 

<ul>
<li>pistahx implements monitoring natively, with the support of the gorgious <strong>ELK stack + appmetrics</strong>. use ELK_SERVER parameter in your ./app/conf/[env].yaml file and you're good to go !</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>DESIGN FIRST :</strong> 

<ul>
<li>pistahx follows the <strong>openapi</strong> specification. creating and modifying your api is done using <strong>yaml language</strong>
</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>MOCK YOUR TESTS IN THE SPEC DESCRIPTION :</strong> 

<ul>
<li>simply mock some test cases (a request and its response) in the <strong>yaml specification</strong> file  and let <strong>mocha</strong> do the magic !</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>AUTOMATIC DOCGEN :</strong> 

<ul>
<li>an <strong>interactive documentation</strong> is automatically generated from the spec file </li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>AUTOMATIC CODEGEN :</strong> 

<ul>
<li>API server code (routing, server core...) is <strong>automatically generated</strong> from the spec file</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>CORE / BUSINESS CODE LOGIC SEPARATION :</strong> 

<ul>
<li>your business logic <strong>is separated from</strong> pistahx server core during the whole life of your project.</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>STRONGLY TYPED CODE :</strong> 

<ul>
<li>Write your business logic using <strong>Haxe language</strong> (type checking helps the code to stay clean and secure). pistahx tranpiles your api to nodejs.</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>OPEN SOURCE, MULTIOS, FAST BOOTSTRAPPING STACK :</strong> 

<ul>
<li>pistahx can be set up (within minutes), modified and deployed <strong>anywhere nodejs can run</strong> : Unix/Linux, Windows, OSx, ...</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>MULTIDB :</strong> 

<ul>
<li> pistahx uses <strong>Sequelize</strong> : connect to mssql, mysql, pgsql, sqlite,... databases</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>PROMISES-FULL :</strong> 

<ul>
<li> Use the great power of promises using a simple Haxe ( <strong>Promhx, Thx.*,..</strong> ) workflow</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>DB PROMISES :</strong> 

<ul>
<li> pistahx handles <strong>parallel db querying strategies</strong>
</li>
</ul>
</li>
</ul>
</blockquote>

<h2></h2>

<blockquote>
<ul>
<li>
<strong>CONTAINER READY :</strong> 

<ul>
<li> pistahx comes with a <strong>native docker container environment</strong> for your app. You can now trully <strong>deploy anywhere !</strong>
</li>
</ul>
</li>
</ul>
</blockquote>

<h1>
<a id="pistahx-insights--code" class="anchor" href="#pistahx-insights--code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pistahx INSIGHTS : code</h1>

<p><strong>SAMPLE CODE : OPEN API YAML ROUTE DEFINITION</strong></p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">paths:</span></span>
  <span class="pl-s"><span class="pl-ent">/employees:</span></span>
    <span class="pl-s"><span class="pl-ent">get:</span></span>
      <span class="pl-s"><span class="pl-ent">operationId:</span> <span class="pl-s">employees</span></span>
      <span class="pl-s"><span class="pl-ent">tags:</span></span>
      <span class="pl-s">- <span class="pl-s"><span class="pl-pds">"</span>Employees<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">summary:</span> <span class="pl-s"><span class="pl-pds">"</span>{'ttl':3600,'xttl':3600,'cachekey':'','xcachekey':''}<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>/employees returns a list of employee<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">responses:</span></span>
        <span class="pl-s"><span class="pl-ent">200:</span></span>
          <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>An array of employees<span class="pl-pds">"</span></span></span>
          <span class="pl-s"><span class="pl-ent">schema:</span></span>
            <span class="pl-s"><span class="pl-ent">$ref:</span> <span class="pl-s"><span class="pl-pds">"</span>#/definitions/Employees<span class="pl-pds">"</span></span></span>
  <span class="pl-s"><span class="pl-ent">/employee/{EmployeeId}:</span></span>
    <span class="pl-s"><span class="pl-ent">get:</span></span>
      <span class="pl-s"><span class="pl-ent">operationId:</span> <span class="pl-s">employee</span></span>
      <span class="pl-s"><span class="pl-ent">tags:</span></span>
      <span class="pl-s">- <span class="pl-s"><span class="pl-pds">"</span>Employees<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">summary:</span> <span class="pl-s"><span class="pl-pds">"</span>{'ttl':3600,'xttl':3600,'cachekey':'','xcachekey':''}<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>/employee/{EmployeeId} returns an employee<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">parameters:</span></span>
      <span class="pl-s">- <span class="pl-ent">name:</span> <span class="pl-s"><span class="pl-pds">"</span>EmployeeId<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">in:</span> <span class="pl-s"><span class="pl-pds">"</span>path<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>EmployeeId<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">required:</span> <span class="pl-c1">true</span></span>
        <span class="pl-s"><span class="pl-ent">type:</span> <span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">responses:</span></span>
        <span class="pl-s"><span class="pl-ent">200:</span></span>
          <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>An employee<span class="pl-pds">"</span></span></span>
          <span class="pl-s"><span class="pl-ent">schema:</span></span>
            <span class="pl-s"><span class="pl-ent">$ref:</span> <span class="pl-s"><span class="pl-pds">"</span>#/definitions/Employee<span class="pl-pds">"</span></span></span>
  <span class="pl-s"><span class="pl-ent">/employee:</span></span>
    <span class="pl-s"><span class="pl-ent">put:</span></span>
      <span class="pl-s"><span class="pl-ent">operationId:</span> <span class="pl-s">employee</span></span>
      <span class="pl-s"><span class="pl-ent">tags:</span></span>
      <span class="pl-s">- <span class="pl-s"><span class="pl-pds">"</span>Employees<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">summary:</span> <span class="pl-s"><span class="pl-pds">"</span>{'ttl':0,'xttl':0,'cachekey':'','xcachekey':''}<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>/employee saves an employee<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">x-cache-flush:</span> </span>
      <span class="pl-s">- <span class="pl-s"><span class="pl-pds">"</span>/employees<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">parameters:</span></span>
      <span class="pl-s">- <span class="pl-ent">name:</span> <span class="pl-s"><span class="pl-pds">"</span>employee<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">in:</span> <span class="pl-s"><span class="pl-pds">"</span>body<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>Employee to add<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">required:</span> <span class="pl-c1">true</span></span>
        <span class="pl-s"><span class="pl-ent">schema:</span></span>
          <span class="pl-s"><span class="pl-ent">$ref:</span> <span class="pl-s"><span class="pl-pds">'</span>#/definitions/Employee<span class="pl-pds">'</span></span></span>
      <span class="pl-s"><span class="pl-ent">responses:</span></span>
        <span class="pl-s"><span class="pl-ent">200:</span></span>
          <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>200 is returned<span class="pl-pds">"</span></span></span></pre></div>

<p><strong>YAML CONFIGURATION : example here : ./app/conf/local.yaml</strong></p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">APP_NAME:</span> <span class="pl-s">pistahx_app</span></span>
<span class="pl-s"><span class="pl-ent">ENV_NAME:</span> <span class="pl-s">local</span></span>
<span class="pl-c">#ELK_SERVER: to be defined</span>
<span class="pl-c">#JWT_SECRET: local_secret_key</span>
<span class="pl-c">#JWT_TTL: 3600</span>
<span class="pl-c1"><span class="pl-ent">CACHE_OUT_TTL_DEFAULT:</span> 60</span>
<span class="pl-c">#GOOGLE_CLIENT_ID: to be defined</span>
<span class="pl-c">#GOOGLE_CLIENT_SECRET: to be defined</span>
<span class="pl-c">#GOOGLE_CALLBACK_URL: http://localhost:3000/callback</span>
<span class="pl-s"><span class="pl-ent">REDIS_HOST:</span> <span class="pl-s">localhost</span></span>
<span class="pl-c1"><span class="pl-ent">REDIS_PORT:</span> 6379</span>
<span class="pl-s"><span class="pl-ent">DB_HOST:</span></span>
<span class="pl-s"><span class="pl-ent">DB_USER:</span></span>
<span class="pl-s"><span class="pl-ent">DB_PASSWORD:</span></span>
<span class="pl-s"><span class="pl-ent">DB_NAME:</span></span>
<span class="pl-s"><span class="pl-ent">DB_OPTIONS:</span> </span>
  <span class="pl-s"><span class="pl-ent">dialect:</span> <span class="pl-s">sqlite</span></span>
  <span class="pl-s"><span class="pl-ent">storage:</span> <span class="pl-s">Chinook_Sqlite.sqlite</span></span>
  <span class="pl-s"><span class="pl-ent">pool:</span> </span>
    <span class="pl-c1"><span class="pl-ent">max:</span> 5</span>
    <span class="pl-c1"><span class="pl-ent">min:</span> 0</span>
    <span class="pl-c1"><span class="pl-ent">idle:</span> 10000</span>
  <span class="pl-s"><span class="pl-ent">dialectOptions:</span></span>
    <span class="pl-s"><span class="pl-ent">encrypt:</span> <span class="pl-c1">true</span></span>
  <span class="pl-s"><span class="pl-ent">logging:</span> <span class="pl-c1">true</span></span>
<span class="pl-c1"><span class="pl-ent">SESSION_TTL:</span> 3600</span>
<span class="pl-s"><span class="pl-ent">BASE_URL:</span> <span class="pl-s">/api/v1</span></span>
<span class="pl-c1"><span class="pl-ent">API_PORT:</span> 3000</span>
<span class="pl-s"><span class="pl-ent">API_ROUTE_STATUS:</span> <span class="pl-s">/users/me/status</span></span>
<span class="pl-c">#API_CORS_ALLOWED:</span>
<span class="pl-c">#  - "http://localhost:9000"</span>
<span class="pl-c">#  - "http://localhost:8080"</span>
<span class="pl-c">#  - "http://localhost:3000"</span>
<span class="pl-c">#S3_ID: "to be defined"</span>
<span class="pl-c">#S3_KEY: "to be defined"</span>
<span class="pl-c">#S3_BUCKET: "to be defined"</span>
<span class="pl-c">#S3_REGION: "to be defined"</span>
<span class="pl-c">#S3_FOLDER: "to be defined"</span></pre></div>

<p><strong>SAMPLE CODE : Sample GET Business method using pistahx-db generated typedefs, and pistahx-spec generated typedefs &amp; mappers</strong></p>

<pre><code>
  typedef DBEmployees = {
    findAll : FindAllOptions -&gt; Promise&lt;Array&lt;DB__Employee&gt;&gt;,
    find : FindOptions -&gt; Promise&lt;DB__Employee&gt;
  }

  @:publicFields
  class DbRepos {

    var dbEmployees : DBEmployees;

    function new(db : Sequelize) {
      dbEmployees = db.import_("models/Employee.js");
      untyped dbAlbums.belongsTo(dbArtist, {foreignKey: 'ArtistId'});
    }

  }

...
...

  public static function get_employees(db : Sequelize,req : ClientRequest, res : ServerResponse, dbcacher : Dynamic,outputcacher : Dynamic, extra : Dynamic) : Promise&lt;Array&lt;Employee&gt;&gt; {    

    var dbr = new DbRepos(db);

    return
      dbr.dbEmployees.findAll({
        limit : 5
      }).then(function (dbEmployeesRes) {
        return dbEmployeesRes.map(EmployeeMapper.dbEmployeeToEmployee); 
      });

  }

  public static function get_employee(db : Sequelize,req : ClientRequest, res : ServerResponse, dbcacher : Dynamic,outputcacher : Dynamic, extra : Dynamic) : Promise&lt;Employee&gt; {

    var dbr = new DbRepos(db);

    return
      dbr.dbEmployees.find({
         where: [ { 'EmployeeId' : untyped req.params.EmployeeId } ]
      }).then(function (dbEmployeeRes) {
        return EmployeeMapper.dbEmployeeToEmployee(dbEmployeeRes);
      });
  }


</code></pre>

<p><strong>SAMPLE CODE : HAXE PROMISES</strong></p>

<pre><code>    public static function firstPromise(/* some args here, such as "myArg : Int" */) : Promise&lt;/* return type here, such as "String"*/&gt;{
      var p = new Deferred&lt;String&gt;();
        some.async.Method(/* some params */, function(err,data){
          p.resolve(data);
        });
      return p.promise();
    }

    public static function secondPromise(/* some args here, such as "myArg : Int" */) : Promise&lt;/* return type here, such as "String"*/&gt;{
      var p = new Deferred&lt;String&gt;();
        some.async.OtherMethod(/* some params */, function(err,data){
          p.resolve(data);
        });
      return p.promise();
    }

    public static function finalPromise(    myArg1 : /* return type of firstPromise */, 
                    myArg2 : /* return type of secondPromise */
                   ) : Promise&lt;/* return type here, such as "String"*/&gt; {
      var p = new Deferred&lt;String&gt;();
         // do something with the results
        some.async.FinalMethod(myArg1, myArg2 , function(err,data){
      // here is our final result
          p.resolve(data);
        });
      return p.promise();
    }

    // NOW YOU CAN USE YOUR PROMISES AS FOLLOWS : 

    // TRIGGER YOUR FIRST PROMISE =&gt; try to fullfill 2 subpromises (parallel)
    Promise.when(           
      firstPromise(/* some args for this first promise */), 
      secondPromise(/* some args for this second promise */)
    )
    .then(
      // WHEN BOTH SUBPROMISES HAVE BEEN FULFILLED :
      // TRIGGER 2ND PROMISE =&gt; gather fulfilled sub-promises results and process them
      function(a,b) return finalPromise(a,b)
    )
    .then(function(b) {
        trace("everything went ok. rainbow.");
    });
</code></pre>

<p><strong>SAMPLE CODE : PARALLEL QUERIES USING PROMISES</strong></p>

<pre><code>     // PARALLEL CALL SOME QUERIES USING SEQUELIZE PROMISES
      var SPromise = Sequelize.Promise;
      SPromise.map([
          sql1,
          sql2
      ], function runQuery(query) {
          return db.query(query);
      }).then(function(result) {
            // result now contains data from sql1 AND sql2 execution
          trace(result);
      });
</code></pre>

<h1>
<a id="end-to-end-tests" class="anchor" href="#end-to-end-tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>End-to-End TESTS</h1>

<p><strong>REMINDER : TESTS (AND MOCK DATAS) ARE DEFINED IN YOUR PROJECT'S API.YAML FILE</strong></p>

<p>=&gt; For each route defined in the spec, you can/should add a <code>x-amples</code> key in wich you can write new tests.</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">paths:</span></span>
  <span class="pl-s"><span class="pl-ent">/users/me/status:</span></span>
    <span class="pl-s"><span class="pl-ent">get:</span></span>
      ...
      ...
      <span class="pl-s"><span class="pl-ent">x-amples:</span></span>
      <span class="pl-s">- <span class="pl-ent">title:</span> <span class="pl-s">TEST1 - fail to auth user 1</span></span>
        <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>fail to auth user<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">request:</span> <span class="pl-s">{}</span></span>
        <span class="pl-s"><span class="pl-ent">response:</span></span>
          <span class="pl-c1"><span class="pl-ent">status:</span> 401</span>
      <span class="pl-s">- <span class="pl-ent">title:</span> <span class="pl-s">TEST2 - fail to auth user 2</span></span>
        <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>fail to auth user<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">request:</span> </span>
          <span class="pl-s"><span class="pl-ent">headers:</span> </span>
            <span class="pl-s"><span class="pl-ent">Authorization:</span> <span class="pl-s"><span class="pl-pds">"</span>Basic bad_auth_hash_key<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">response:</span></span>
          <span class="pl-c1"><span class="pl-ent">status:</span> 401</span>
      <span class="pl-s">- <span class="pl-ent">title:</span> <span class="pl-s">TEST3 - auth user ok</span></span>
        <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>auth user ok<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">request:</span> </span>
          <span class="pl-s"><span class="pl-ent">headers:</span> </span>
            <span class="pl-s"><span class="pl-ent">Authorization:</span> <span class="pl-s"><span class="pl-pds">"</span>Basic ZDSGOJGDFJKLGFJKSFLDGJLJGSFKLFDJGSLJFDGSLJ=<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">response:</span></span>
          <span class="pl-c1"><span class="pl-ent">status:</span> 200</span>
          <span class="pl-s"><span class="pl-ent">body:</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></span></pre></div>

<p><strong>--- run tests locally:</strong></p>

<p>1 . Change the host value in the api.yaml file to <code>localhost:3000</code> </p>

<p>2 . You will need a running api (local)</p>

<p>3 . Run the test suite using mocha <strong>(run this from the project's root folder, NOT from the ./distrib/ folder !)</strong> :</p>

<p><code>mocha test.js</code></p>

<h1>
<a id="docs" class="anchor" href="#docs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DOCS</h1>

<ul>
<li><p><strong>api description</strong> resides in your project's <code>./app/api.yaml</code> file</p></li>
<li><p><strong>api interactive doc</strong> can be seen here : <code>http://[host]/doc</code></p></li>
<li><p><strong>haxedoc</strong> can be seen here : <code>http://[host]/haxedoc</code></p></li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/mebyz/pistahx">pistahx.io</a> is maintained by <a href="https://github.com/mebyz">mebyz</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
