<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>pistahx.io by mebyz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">pistahx.io</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/mebyz/pistahx" class="btn">View on GitHub</a>
      <a href="https://github.com/mebyz/pistahx/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/mebyz/pistahx/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="pistahxio--design-first-type-safe-haxe-web-api-framework" class="anchor" href="#pistahxio--design-first-type-safe-haxe-web-api-framework" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pistahx.io : Design-First Type-Safe Haxe Web API Framework</h1>

<blockquote>
<hr>

<ul>
<li>We'll be happy to meet you during WWX2016, the WorldWide Haxe conference in Paris (27-30 May 2016) ! </li>
</ul>

<p><img src="http://www.silexlabs.org/wp-content/uploads/2016/02/wwx2016-bandeau-blog-18fev2016-687x159.png" alt=""></p>

<ul>
<li>We are thrilled to give you the opportunity to attend to the first and live full presentation of pistahx (40 min talk)</li>
</ul>

<hr>
</blockquote>

<ul>
<li><strong>pistahx Building blocks :</strong></li>
</ul>

<pre><code>
Haxe, Nodejs, Mustache, Yaml, Bash scripts, 
Haxe/Node gems including thx.*, PromHx, Express, Sequelize, Tedious, 
Crypto, Dox, Open API (spec,codegen,doc ui,..), Redis, ELK, Passport.js, ...

</code></pre>

<p><img src="https://raw.githubusercontent.com/mebyz/pistahx/master/pistahx-stack-mini.png" alt=""></p>

<ul>
<li>
<p><strong>PERFORMANCE :</strong> pistahx heavily relies on <strong>many cache layers</strong>, and let you define your own <strong>cache invalidation strategies</strong></p>

<ul>
<li><p>Custom output cache for each route based on your api specs</p></li>
<li><p>Secure Cookie based Session / Auth token Redis store</p></li>
<li><p>Pro-active cascading cache invalidation strategies</p></li>
<li><p>Db caching (via Sequelize) : use cache to store entities and queries</p></li>
<li><p>Define your own caching strategies for fine tuning</p></li>
</ul>
</li>
<li>
<p><strong>SECURITY :</strong> pistahx offers you <strong>multiple authentication strategies</strong> activate them in your configuration file ./app/conf/[env].yaml </p>

<ul>
<li><p>JSON Web Tokens (JWT) : if you want to build RestFULL APIs or if you have to deal with cookie-less clients</p></li>
<li><p>Standard but fast and secure sessions strategy if you're setting up a service targeting Web browsers supporting cookies</p></li>
<li><p>pistahx also implements Passport.js (which includes 300+ more auth strategies) !</p></li>
</ul>
</li>
<li><p><strong>MONITORING :</strong> pistahx implements monitoring natively, with the support of the gorgious <strong>ELK stack + appmetrics</strong>. use ELK_SERVER parameter in your ./app/conf/[env].yaml file and you're good to go !</p></li>
<li><p><strong>DESIGN FIRST :</strong> pistahx follows the <strong>openapi</strong> specification. creating and modifying your api is done using <strong>yaml language</strong></p></li>
<li><p><strong>MOCK YOUR TESTS IN THE SPEC DESCRIPTION :</strong> simply mock some test cases (a request and its response) in the <strong>yaml specification</strong> file  and let <strong>mocha</strong> do the magic !</p></li>
<li><p><strong>AUTOMATIC DOCGEN :</strong> an <strong>interactive documentation</strong> is automatically generated from the spec file </p></li>
<li><p><strong>AUTOMATIC CODEGEN :</strong> API server code (routing, server core...) is <strong>automatically generated</strong> from the spec file</p></li>
<li><p><strong>CORE / BUSINESS CODE LOGIC SEPARATION :</strong> your business logic <strong>is separated from</strong> pistahx server core are during the whole life af your project.</p></li>
<li><p><strong>STRONGLY TYPED CODE :</strong> Write your business logic using <strong>Haxe language</strong> (type checking helps the code to stay clean and secure). target is nodejs for now</p></li>
<li><p><strong>OPEN SOURCE, MULTIOS, FAST BOOTSTRAPPING STACK :</strong> pistahx can be set up (within minutes), modified and deployed <strong>anywhere nodejs can run</strong> : Unix/Linux, Windows, OSx, ...</p></li>
<li><p><strong>MULTIDB :</strong> pistahx uses <strong>Sequelize</strong> : connect to mssql, mysql, pgsql, sqlite,... databases</p></li>
<li><p><strong>PROMISES-FULL :</strong> Use the great power of promises using a simple Haxe ( <strong>Promhx, Thx.*,..</strong> ) workflow</p></li>
<li><p><strong>DB PROMISES :</strong> pistahx handles <strong>parallel db querying strategies</strong></p></li>
<li><p><strong>CONTAINER READY :</strong> pistahx comes with a <strong>native docker container environment</strong> for your app. You can now trully <strong>deploy anywhere !</strong></p></li>
</ul>

<h1>
<a id="build-your-api-using-pistahx" class="anchor" href="#build-your-api-using-pistahx" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>BUILD YOUR API USING pistahx</h1>

<p><strong>remider: pistahx is meant to be used as a dependency !!</strong></p>

<p><strong>STEP BY STEP :</strong></p>

<p><strong>1 .Fork <a href="https://github.com/mebyz/pistahx-app">https://github.com/mebyz/pistahx-app</a> to bootstrap you own pistahx app !</strong></p>

<p>2 . You'll need <strong>Haxe</strong> installed on your system</p>

<p>3 . Design and implement your api : </p>

<ul>
<li><p>Define your api spec in the <strong>./app/api.yaml</strong> file</p></li>
<li><p>Code your business logic in the <strong>./app/Business/</strong> folder</p></li>
<li><p>Use the <strong>./app/conf/[env].yaml</strong> file to set your configuration (db user/pass, ...)</p></li>
</ul>

<p>4 . you'll need a running database server</p>

<p>5 . you'll need a running <strong>redis server</strong> ( locally : <code>redis-server</code> )</p>

<p><strong>=&gt; compile using :</strong> <code>./build.sh</code></p>

<p><strong>- You can then simply run your api using :</strong> <code>./run.sh</code></p>

<p><strong>- or deploy a local docker container and run your api from here :</strong> <code>./docker.sh</code></p>

<h1>
<a id="pistahx-insights--code" class="anchor" href="#pistahx-insights--code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pistahx INSIGHTS : code</h1>

<p><strong>SAMPLE CODE : OPEN API YAML ROUTE DEFINITION</strong></p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">paths:</span></span>
  <span class="pl-s"><span class="pl-ent">/cars:</span></span>
    <span class="pl-s"><span class="pl-ent">get:</span></span>
      <span class="pl-s"><span class="pl-ent">operationId:</span> <span class="pl-s">cars</span></span>
      <span class="pl-s"><span class="pl-ent">tags:</span></span>
      <span class="pl-s">- <span class="pl-s"><span class="pl-pds">"</span>Stores<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">summary:</span> <span class="pl-s"><span class="pl-pds">"</span>{'ttl':3600,'xttl':3600,'cachekey':'','xcachekey':''}<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>The Cars List returns information about cars<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">parameters:</span></span>
      <span class="pl-s">- <span class="pl-ent">name:</span> <span class="pl-s"><span class="pl-pds">"</span>AccessKeyId<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">in:</span> <span class="pl-s"><span class="pl-pds">"</span>header<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>Access Key Id<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">required:</span> <span class="pl-s">false</span></span>
        <span class="pl-s"><span class="pl-ent">type:</span> <span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span></span>
      <span class="pl-s"><span class="pl-ent">responses:</span></span>
        <span class="pl-s"><span class="pl-ent">200:</span></span>
          <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>An array of cars<span class="pl-pds">"</span></span></span>
          <span class="pl-s"><span class="pl-ent">schema:</span></span>
            <span class="pl-s"><span class="pl-ent">$ref:</span> <span class="pl-s"><span class="pl-pds">"</span>#/definitions/Cars<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">default:</span></span>
          <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>Unexpected error<span class="pl-pds">"</span></span></span>
          <span class="pl-s"><span class="pl-ent">schema:</span></span>
            <span class="pl-s"><span class="pl-ent">$ref:</span> <span class="pl-s"><span class="pl-pds">"</span>#/definitions/Error<span class="pl-pds">"</span></span></span></pre></div>

<p><strong>YAML CONFIGURATION : example here : ./app/conf/local.yaml</strong></p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">APP_NAME:</span> <span class="pl-s">pistahx_sample_app</span></span>
<span class="pl-s"><span class="pl-ent">ENV_NAME:</span> <span class="pl-s">local</span></span>
<span class="pl-c">#ELK_SERVER: to be defined</span>
<span class="pl-c">#JWT_SECRET: local_secret_key</span>
<span class="pl-c">#JWT_TTL: 3600</span>
<span class="pl-c1"><span class="pl-ent">CACHE_OUT_TTL_DEFAULT:</span> 60</span>
<span class="pl-c">#GOOGLE_CLIENT_ID: to be defined</span>
<span class="pl-c">#GOOGLE_CLIENT_SECRET: to be defined</span>
<span class="pl-c">#GOOGLE_CALLBACK_URL: http://localhost:3000/callback</span>
<span class="pl-s"><span class="pl-ent">REDIS_HOST:</span> <span class="pl-s">localhost</span></span>
<span class="pl-c1"><span class="pl-ent">REDIS_PORT:</span> 6379</span>
<span class="pl-s"><span class="pl-ent">DB_HOST:</span></span>
<span class="pl-s"><span class="pl-ent">DB_USER:</span></span>
<span class="pl-s"><span class="pl-ent">DB_PASSWORD:</span></span>
<span class="pl-s"><span class="pl-ent">DB_NAME:</span></span>
<span class="pl-s"><span class="pl-ent">DB_OPTIONS:</span> </span>
  <span class="pl-s"><span class="pl-ent">dialect:</span> <span class="pl-s">sqlite</span></span>
  <span class="pl-s"><span class="pl-ent">storage:</span> <span class="pl-s">../db.sqlite</span></span>
  <span class="pl-s"><span class="pl-ent">pool:</span> </span>
    <span class="pl-c1"><span class="pl-ent">max:</span> 5</span>
    <span class="pl-c1"><span class="pl-ent">min:</span> 0</span>
    <span class="pl-c1"><span class="pl-ent">idle:</span> 10000</span>
  <span class="pl-s"><span class="pl-ent">dialectOptions:</span></span>
    <span class="pl-s"><span class="pl-ent">encrypt:</span> <span class="pl-s">true</span></span>
  <span class="pl-s"><span class="pl-ent">logging:</span> <span class="pl-s">false</span></span>
<span class="pl-c1"><span class="pl-ent">SESSION_TTL:</span> 3600</span>
<span class="pl-s"><span class="pl-ent">BASE_URL:</span> <span class="pl-s">/api/v1</span></span>
<span class="pl-c1"><span class="pl-ent">API_PORT:</span> 3000</span></pre></div>

<p><strong>SAMPLE CODE : HAXE PROMISES</strong></p>

<pre><code>    public static function firstPromise(/* some args here, such as "myArg : Int" */) : Promise&lt;/* return type here, such as "String"*/&gt;{
      var p = new Deferred&lt;String&gt;();
        some.async.Method(/* some params */, function(err,data){
          p.resolve(data);
        });
      return p.promise();
    }

    public static function secondPromise(/* some args here, such as "myArg : Int" */) : Promise&lt;/* return type here, such as "String"*/&gt;{
      var p = new Deferred&lt;String&gt;();
        some.async.OtherMethod(/* some params */, function(err,data){
          p.resolve(data);
        });
      return p.promise();
    }

    public static function finalPromise(    myArg1 : /* return type of firstPromise */, 
                    myArg2 : /* return type of secondPromise */
                   ) : Promise&lt;/* return type here, such as "String"*/&gt; {
      var p = new Deferred&lt;String&gt;();
         // do something with the results
        some.async.FinalMethod(myArg1, myArg2 , function(err,data){
      // here is our final result
          p.resolve(data);
        });
      return p.promise();
    }

    // NOW YOU CAN USE YOUR PROMISES AS FOLLOWS : 

    // TRIGGER YOUR FIRST PROMISE =&gt; try to fullfill 2 subpromises (parallel)
    Promise.when(           
      firstPromise(/* some args for this first promise */), 
      secondPromise(/* some args for this second promise */)
    )
    .then(
      // WHEN BOTH SUBPROMISES HAVE BEEN FULFILLED :
      // TRIGGER 2ND PROMISE =&gt; gather fulfilled sub-promises results and process them
      function(a,b) return finalPromise(a,b)
    )
    .then(function(b) {
        trace("everything went ok. rainbow.");
    });
</code></pre>

<p><strong>SAMPLE CODE : PARALLEL QUERIES USING PROMISES</strong></p>

<pre><code>     // PARALLEL CALL SOME QUERIES USING SEQUELIZE PROMISES
      var SPromise = Sequelize.Promise;
      SPromise.map([
          sql1,
          sql2
      ], function runQuery(query) {
          return db.query(query);
      }).then(function(result) {
            // result now contains data from sql1 AND sql2 execution
          trace(result);
      });
</code></pre>

<h1>
<a id="end-to-end-tests" class="anchor" href="#end-to-end-tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>End-to-End TESTS</h1>

<p><strong>REMINDER : TESTS (AND MOCK DATAS) ARE DEFINED IN YOUR PROJECT'S API.YAML FILE</strong></p>

<p>=&gt; For each route defined in the spec, you can/should add a <code>x-amples</code> key in wich you can write new tests.</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">paths:</span></span>
  <span class="pl-s"><span class="pl-ent">/users/me/status:</span></span>
    <span class="pl-s"><span class="pl-ent">get:</span></span>
      ...
      ...
      <span class="pl-s"><span class="pl-ent">x-amples:</span></span>
      <span class="pl-s">- <span class="pl-ent">title:</span> <span class="pl-s">TEST1 - fail to auth user 1</span></span>
        <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>fail to auth user<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">request:</span> <span class="pl-s">{}</span></span>
        <span class="pl-s"><span class="pl-ent">response:</span></span>
          <span class="pl-c1"><span class="pl-ent">status:</span> 401</span>
      <span class="pl-s">- <span class="pl-ent">title:</span> <span class="pl-s">TEST2 - fail to auth user 2</span></span>
        <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>fail to auth user<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">request:</span> </span>
          <span class="pl-s"><span class="pl-ent">headers:</span> </span>
            <span class="pl-s"><span class="pl-ent">Authorization:</span> <span class="pl-s"><span class="pl-pds">"</span>Basic bad_auth_hash_key<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">response:</span></span>
          <span class="pl-c1"><span class="pl-ent">status:</span> 401</span>
      <span class="pl-s">- <span class="pl-ent">title:</span> <span class="pl-s">TEST3 - auth user ok</span></span>
        <span class="pl-s"><span class="pl-ent">description:</span> <span class="pl-s"><span class="pl-pds">"</span>auth user ok<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">request:</span> </span>
          <span class="pl-s"><span class="pl-ent">headers:</span> </span>
            <span class="pl-s"><span class="pl-ent">Authorization:</span> <span class="pl-s"><span class="pl-pds">"</span>Basic ZDSGOJGDFJKLGFJKSFLDGJLJGSFKLFDJGSLJFDGSLJ=<span class="pl-pds">"</span></span></span>
        <span class="pl-s"><span class="pl-ent">response:</span></span>
          <span class="pl-c1"><span class="pl-ent">status:</span> 200</span>
          <span class="pl-s"><span class="pl-ent">body:</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></span></pre></div>

<p><strong>--- run tests locally:</strong></p>

<p>1 . Change the host value in the api.yaml file to <code>localhost:3000</code> </p>

<p>2 . You will need a running api (local)</p>

<p>3 . Run the test suite using mocha <strong>(run this from the project's root folder, NOT from the ./distrib/ folder !)</strong> :</p>

<p><code>npm install</code></p>

<p><code>mocha test.js</code></p>

<h1>
<a id="docs" class="anchor" href="#docs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DOCS</h1>

<ul>
<li><p><strong>api description</strong> resides in your project's <code>./app/api.yaml</code> file</p></li>
<li><p><strong>api interactive doc</strong> can be seen here : <code>http://[host]/doc</code></p></li>
<li><p><strong>haxedoc</strong> can be seen here : <code>http://[host]/haxedoc</code></p></li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/mebyz/pistahx">pistahx.io</a> is maintained by <a href="https://github.com/mebyz">mebyz</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
